angular.module('ionicz.lottery')
.directive("myPopover",function(){return{restrict:"C",scope:!0,link:function(a,b){b.find("a").bind("click",function(){a.popover.hide()})}}})
.directive("scrollbarX",function(){return{restrict:"A",link:function(a,b){"false"==b.attr("scrollbar-x")&&b.removeClass("scroll-x")}}})
.directive("bet",["Tools",function(a){return{restrict:"C",scope:!0,link:function(b,c){var f,h,e="j"+(c.attr("data-id")||"00"),g=angular.element(c[0].querySelector(".bet-item"));b.shareData.elements=b.shareData.elements||angular.element(),b.shareData.elements.push(c[0]),c.attr("data-id")&&(b.$on("lotteryUpdateOdds",function(){f="j"+(b.curGame.superId||b.curGame.panType+"00"),1==b.shareData.lotteryState&&b.curGame.odds&&(b.curGame.odds[e]||b.curGame.odds[f])?(h=b.curGame.odds[e],h?g.data("odds")!=h&&g.html(h).data("odds",h):h=b.curGame.odds[f]):(h=void 0,g.data("odds")&&g.html("--").removeData("odds"))}),b.isExist(e)&&c.addClass("bet-choose"),c.bind("click",function(){var d;2==b.curGame.panMode&&b.hasFixed()&&(d="bet-circled"),h&&!c.hasClass("bet-circled")&&!c.hasClass("bet-disabled")&&(c.attr("data-once")&&angular.forEach(b.shareData.elements,function(a){a=angular.element(a),a.attr("data-once")&&a.attr("data-once")==c.attr("data-once")&&"j"+a.attr("data-id")!=e&&a.hasClass("bet-choose")&&(a.toggleClass("bet-choose"),b.toggleSelect("j"+a.attr("data-id"),a.attr("data-pane")))}),b.curGame.panLimit.max&&!c.hasClass("bet-choose")&&b.betData[b.currPane]&&b.betData[b.currPane].length+1>b.curGame.panLimit.max?a.tip("只能选择"+(b.curGame.panLimit.min&&b.curGame.panLimit.min<b.curGame.panLimit.max?b.curGame.panLimit.min+"-":"")+b.curGame.panLimit.max+"个号码"):(c.toggleClass(d||"bet-choose"),b.toggleSelect(e,c.attr("data-pane")),"a1"==c.attr("data-once")&&(b.shareData.panFirstText=c.find("div").text()),"a2"==c.attr("data-once")&&(b.shareData.panEndText=c.find("div").text())))}))}}}])
.directive("subCol",function(){return{restrict:"C",scope:!0,link:function(a,b){!b.parent().hasClass("tips")&&b.bind("click",function(){a.curGame.panMode=parseInt(b.attr("data-mode")||b.attr("data-show")||1),b.attr("data-mode")?a.shareData.panTitleText=b.find("a").text():(a.curGame.panType=b.attr("data-pan")||b.attr("data-subPan"),b.attr("data-subPan")||(a.curGame.panLimit={min:parseInt(b.attr("data-min")||0),max:parseInt(b.attr("data-max")||0)})),a.curGame.panType&&a.$emit("lotteryUpdate","GetLines"),!b.attr("data-show")&&a.curGame.reset&&a.curGame.reset.indexOf(a.currPane)>=0&&a.reset()})}}})
.directive("betView",function(){return{restrict:"C",scope:!0,link:function(a,b){var d,e;a.curGame.superId=b.attr("data-sid"),a.curGame.superLimit=(b.attr("data-limit")||"").split(","),a.curGame.panType=b.attr("data-pan"),a.curGame.panMode=parseInt(b.attr("data-mode")||b.attr("data-show")||1),a.curGame.panLimit={min:parseInt(b.attr("data-min")||0),max:parseInt(b.attr("data-max")||0)},a.curGame.panType&&a.$emit("lotteryUpdate","GetLines"),angular.forEach(b.find("*"),function(b){b=angular.element(b),b.hasClass("title-no")||b.hasClass("title")?d=b.text():b.hasClass("col")&&b.attr("data-id")?e=b.attr("data-id"):b.hasClass("bet-content")&&d&&e&&(a.betContent["j"+e]={type:d,content:b.text()})})}}})
.directive("qxcBet",["Tools",function(){return{restrict:"C",scope:!0,link:function(a,b){var e,f,d=b.attr("data-id");d&&(a.$on("lotteryUpdateOdds",function(){e="j"+a.curGame.superId,f=1==a.shareData.lotteryState&&a.curGame.odds&&a.curGame.odds[e]?a.curGame.odds[e]:void 0}),d=d.split(","),d[1]=parseInt(d[1]),d[2]=parseInt(d[2]),a.shareData.elements=a.shareData.elements||[],a.shareData.elements[d[1]]=a.shareData.elements[d[1]]||angular.element(),a.shareData.elements[d[1]].push(b[0]),b.bind("click",function(){var c,e,g,h=[],i=[];!b.hasClass("bet-disabled")&&a.curGame.superLimit&&f&&(g=parseInt(a.curGame.superLimit[0]),a.betData["qxc-temp"]=a.betData["qxc-temp"]||[[],[],[],[],0],c=a.betData["qxc-temp"][d[1]],b.toggleClass("bet-choose"),e=c.indexOf(d[2]),e>=0?c.splice(e,1):(c.push(d[2]),c.sort()),a.betData["qxc-temp"][4]=0,a.betData["qxc-temp"][d[1]]=c,angular.forEach(a.betData["qxc-temp"],function(b,c){4>c&&(1==g?a.betData["qxc-temp"][4]+=b.length:b.length>0?h.push(b.length):i.push(c))}),g>1&&(h.length==g&&angular.forEach(h,function(b){a.betData["qxc-temp"][4]=(a.betData["qxc-temp"][4]||1)*b}),angular.forEach(i,function(b){h.length==g?a.shareData.elements[b].addClass("bet-disabled"):a.shareData.elements[b].removeClass("bet-disabled")})))}))}}}])
.directive("qxcQuickSelect",["Tools",function(a){return{restrict:"C",scope:!0,link:function(b,c){var e=c.attr("data-sid");e&&(e=e.split(","),b.shareData.elements=b.shareData.elements||[],b.shareData.elements[e[1]]=b.shareData.elements[e[1]]||angular.element(),b.shareData.elements[e[1]].push(c[0]),c.bind("click",function(){var d=a.modal({title:c.text()+"位",scope:b,template:'<div class="row"><div class="col col-33"><button class="button button-block button-positive" ng-click="onClick(1)" ng-disabled="disabled">全选</button></div><div class="col col-33"><button class="button button-block button-positive" ng-click="onClick(2)" ng-disabled="disabled">大数</button></div><div class="col col-33"><button class="button button-block button-positive" ng-click="onClick(3)" ng-disabled="disabled">小数</button></div></div><div class="row"><div class="col col-33"><button class="button button-block button-positive" ng-click="onClick(4)" ng-disabled="disabled">奇数</button></div><div class="col col-33"><button class="button button-block button-positive" ng-click="onClick(5)" ng-disabled="disabled">偶数</button></div><div class="col col-33"><button class="button button-block button-positive" ng-click="onClick(6)" ng-disabled="disabled">清空</button></div></div>',css:"quick-select",cancelText:"关闭",okText:"全清",callback:function(){d.close(),b.betData["qxc-temp"]=[[],[],[],[],0],angular.forEach(b.shareData.elements,function(a){a.removeClass("bet-choose bet-disabled")})}});b.disabled=c.hasClass("bet-disabled"),b.onClick=function(a){angular.forEach(b.shareData.elements[e[1]],function(b){b=angular.element(b);var c=b.attr("data-id");if(a>=6&&b.hasClass("bet-disabled")&&b.toggleClass("bet-disabled"),c){switch(c=c.split(","),c[2]=parseInt(c[2]),!0){case 1==a:case 2==a&&c[2]>=5:case 3==a&&c[2]<5:case 4==a&&1==c[2]%2:case 5==a&&1!=c[2]%2:c[0]=!b.hasClass("bet-choose");break;default:c[0]=b.hasClass("bet-choose")}c[0]&&b.triggerHandler("click")}}),d.close()}}))}}}])
.directive("qxcAddButton",["Tools",function(a){return{restrict:"C",scope:!0,link:function(b,c){c.bind("click",function(){var c=b.betData["qxc-temp"]||[[],[],[],[],0];b.betData.betContent=b.betData.betContent||[],b.curGame.superLimit&&(c[4]>0?(c=angular.copy(c),b.betData.betContent.push(c),b.shareData.betCount+=c[4],b.betData[b.currPane]=[!0],b.betData["qxc-temp"]=[[],[],[],[],0],angular.forEach(b.shareData.elements,function(a){a.removeClass("bet-choose bet-disabled")})):a.tip("您至少需要选择"+b.curGame.superLimit[0]+"个位置的号码"))})}}}])
.directive("qxcList",["Tools",function(a){return{restrict:"EC",scope:!0,template:'<div><div class="item" ng-repeat="data in betData.betContent" ng-click="showDetail($index)"><h3>{{data[0].length>0?data[0].join(""):"*"}}, {{data[1].length>0?data[1].join(""):"*"}}, {{data[2].length>0?data[2].join(""):"*"}}, {{data[3].length>0?data[3].join(""):"*"}}</h3><p class="ng-binding">共 {{data[4]}} 注，点击查看详情</p></div></div>',replace:!0,link:function(b){b.showDetail=function(c){b.detail=angular.copy(b.betData.betContent[c]),b.detail[0]=b.detail[0].length>0?b.detail[0].join(", "):"* (任意数字)",b.detail[1]=b.detail[1].length>0?b.detail[1].join(", "):"* (任意数字)",b.detail[2]=b.detail[2].length>0?b.detail[2].join(", "):"* (任意数字)",b.detail[3]=b.detail[3].length>0?b.detail[3].join(", "):"* (任意数字)",a.modal({scope:b,title:"详情",template:'<div class="row"><div class="col ng-binding">仟位：{{detail[0]}}</div></div><div class="row"><div class="col ng-binding">佰位：{{detail[1]}}</div></div><div class="row"><div class="col ng-binding">拾位：{{detail[2]}}</div></div><div class="row"><div class="col ng-binding">个位：{{detail[3]}}</div></div><div class="row"><div class="col ng-binding">注数：{{detail[4]}}</div></div>',cancelText:"关闭",okText:"删除",callback:function(a,b){a.betData.betContent.splice(c,1),a.shareData.betCount-=a.detail[4],a.betData[a.currPane]=a.shareData.betCount>0?[!0]:[],b.close()}})}}}}])