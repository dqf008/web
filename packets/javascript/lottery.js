var isClick=false,isWaiting=0,last,one,two,get;$(window).resize(function(){$("#light").css("left",($(window).width()-589)/2)});$(document.body).ready(function(){var a=true;setInterval(function(){var c=$("#list_index"),b=c.parent().height(),d=Math.abs(parseInt(c.css("margin-top")))+b;if(c.height()>b&&Math.floor(c.height()/b)*b>d){c.animate({marginTop:(-1*d)+"px"})}else{c.animate({marginTop:0})}},3000);$("#msg_win").hide();$(".flash").on("click","[data-key=logn]",function(){if(isClick){return false}$(this).stop().remove();if($("#username").val()==""){$("#j-logn").show();$("#hongbao_back").show()}else{checkUser()}});$("[data-key=lognClose]").click(function(){$("#j-logn").hide();$("#hongbao_back").hide()});if(IS_CLOSE){$(".fond_div").hide();$("#hb_end").show()}else{getPackets()}getLastest()});function getLastest(){clearTimeout(last);$.ajax({url:PACKETS_URL+"ajax.php",data:{action:"lastest"},dataType:"json",cache:false,type:"POST",success:function(a){last=setTimeout(getLastest,15000);$("#list_index").empty();$.each(a,function(b,c){$('<li data-key="'+b+'">'+c["time"]+"<span>"+c["username"]+"</span>抢到<em>"+c["money"]+"</em>元红包</li>").appendTo("#list_index")})}})}function getPackets(){clearTimeout(get);$.ajax({url:PACKETS_URL+"ajax.php",data:{action:"info"},dataType:"json",cache:false,type:"POST",success:function(a){if(a["close"]==0||a["next"]==-1){isWaiting=0;$("#hb_end").show()}else{get=setTimeout(getPackets,10000);if(a["next"]>0){if(isWaiting!=1){clearInterval(two);clearInterval(one);TIME.setTime((new Date()).getTime()+(a["next"]*1000));one=setInterval(waitingOpen,500)}}else{if(a["open"]>0){if(isWaiting!=2){clearInterval(two);clearInterval(one);TIME.setTime((new Date()).getTime()+(a["open"]*1000));one=setInterval(waitingStart,500)}}else{if(a["end"]>0){if(isWaiting!=3){clearInterval(two);clearInterval(one);TIME.setTime((new Date()).getTime()+(a["end"]*1000));one=setInterval(waitingClose,500);two=setInterval(startPackets,200)}}}}}}})}function waitingOpen(){isWaiting=1;$("#hb_wait").show().siblings(".fond_div").hide();var b=TIME.getTime()-(new Date()).getTime();if(b<=0){isWaiting=0;clearInterval(one);getPackets()}else{var f=Math.floor(b/1000/60/60/24);var e=Math.floor(b/1000/60/60%24);var a=Math.floor(b/1000/60%60);var c=Math.floor(b/1000%60);var e=f*24+e;$("#luck_title2").html("<div>&nbsp;</div><div>"+e+"</div><p>小时</p>"+"<div>"+a+"</div><p>分</p>"+"<div>"+c+"</div><p>秒</p>")}}function waitingStart(){isWaiting=2;$("#hb_start").show().siblings(".fond_div").hide();var b=TIME.getTime()-(new Date()).getTime();if(b<=0){isWaiting=0;clearInterval(one);getPackets()}else{var f=Math.floor(b/1000/60/60/24);var e=Math.floor(b/1000/60/60%24);var a=Math.floor(b/1000/60%60);var c=Math.floor(b/1000%60);$("#luck_title").html("<div>"+f+"</div><p>天</p>"+"<div>"+e+"</div><p>小时</p>"+"<div>"+a+"</div><p>分</p>"+"<div>"+c+"</div><p>秒</p>")}}function waitingClose(){isWaiting=3;$("#hb_for").show().siblings(".fond_div").hide();var b=TIME.getTime()-(new Date()).getTime();if(b<=0){isWaiting=0;clearInterval(two);clearInterval(one);getPackets()}else{var f=Math.floor(b/1000/60/60/24);var e=Math.floor(b/1000/60/60%24);var a=Math.floor(b/1000/60%60);var c=Math.floor(b/1000%60);var e=f*24+e;$("#luck_title3").html("<div>&nbsp;</div><div>"+e+"</div><p>小时</p>"+"<div>"+a+"</div><p>分</p>"+"<div>"+c+"</div><p>秒</p>")}}function close_hongbao(){if(isClick){return false}$("#hongbao_result").find(".w2").html("恭喜发财，大吉大利");$("#hongbao_open").hide();$("#hongbao_result").hide();$("#hongbao_back").hide();$("#hongbao_open").removeClass("out");$("#hongbao_result").removeClass("in").hide()}function checkUser(){$("#j-logn").hide();if($("#username").val()==""){showMsg("请输入会员账号");return false}$.ajax({url:PACKETS_URL+"ajax.php",dataType:"json",cache:false,type:"POST",data:{action:"check",username:$("#username").val()},success:function(a){switch(a["status"]){case 99:showMsg("活动尚未开始");$("#username").val("");break;case 98:showMsg("会员帐号不存在");$("#username").val("");break;case 97:showMsg("您的帐号无法领取红包");$("#username").val("");break;case 96:showMsg("您的帐号次数已经用完");$("#username").val("");break;case 95:showMsg("请您先绑定手机号");$("#username").val("");break;case 94:showMsg("请您先设置银行卡信息");$("#username").val("");break;case 0:if(a["score"]==1){$("#b5").html("恭喜发财，大吉大利")}else{if(a["score"]==2){$("#b5").html("您还有两次机会")}else{$("#b5").html("您还有"+a["score"]+"次机会")}}$("#hongbao_open").show();$("#hongbao_back").show();break;default:alert("网络错误，请稍后再试");break}}})}function startPackets(){var c=$(window).height();var g=$(document).width();var h=Math.random()*g-100;var i=0.5+Math.random();var a=10+Math.random()*30;var b=h-100+200*Math.random();var d=2000+5000*Math.random();$('<div data-key="logn" class="snow snow-'+Math.floor(Math.random()*3+1)+'"><div>').clone().appendTo(".flash").css({left:h+"px",opacity:i,"font-size":a,}).animate({top:(c*1)+"px",left:b+"px",opacity:0.1,},d,"linear",function(){$(this).remove()})}function startGame(){if(isClick){return false}if($("#username").val()==""){showMsg("请输入会员账号");return false}isClick=true;$("#hongbao_open").addClass("shake");setTimeout(function(){$.ajax({url:PACKETS_URL+"ajax.php",dataType:"json",cache:false,type:"POST",data:{action:"bonus",username:$("#username").val()},success:function(a){$("#hongbao_open").removeClass("shake");isClick=false;switch(a["status"]){case 99:showMsg("活动尚未开始");break;case 98:showMsg("会员帐号不存在");break;case 97:showMsg("您的帐号无法领取红包");break;case 96:showMsg("您的帐号次数已经用完");break;case 95:showMsg("请您先绑定手机号");break;case 94:showMsg("请您先设置银行卡信息");break;case 0:$("#hongbao_result").find(".w3").html("谢谢参与").css("font-size","50px");$("#hongbao_result").find(".w2").html(a["msg"]);$("#hongbao_open").addClass("out").fadeOut();$("#hongbao_result").fadeIn().addClass("in");break;case 1:$("#hongbao_result").find(".w3").html(a["money"]+"<em>元</em>").css("font-size","78px");$("#hongbao_result").find(".w2").html(a["msg"]);$("#hongbao_open").addClass("out").fadeOut();$("#hongbao_result").fadeIn().addClass("in");getPackets();getLastest();break;default:alert("网络错误，请稍后再抽奖");break}},failure:function(){$("#hongbao_open").removeClass("shake");isClick=false},error:function(a,c,b){$("#hongbao_open").removeClass("shake");isClick=false;alert("发生未知错误，请联系在线客服")}})},Math.floor(1000+(Math.random()*1000)))}function showMsg(a){$("#j-logn").hide();$("#hongbao_open").hide();$("#hongbao_back").show();$("#hongbao_result").show();$("#hongbao_result").find(".w3").html("温馨提示").css("font-size","50px");$("#hongbao_result").find(".w2").html(a);$("#hongbao_result").fadeIn().addClass("in")}function queryBtn(){if($("#querycode").val()==""){showMsg("请输入会员账号");return false}queryPage(1)}function queryPage(a){$.ajax({url:PACKETS_URL+"ajax.php",dataType:"json",cache:false,data:{action:"query",username:$("#querycode").val(),page:a},type:"POST",success:function(b){$("#query_content, .quotes").empty();if(b["count"]>0){$.each(b["list"],function(c,d){$("<tr><td>"+d["money"]+"</td><td>"+d["time"]+"</td><td>"+(d["status"]==1?'<font color="yellow">已派彩</font>':'<font color="white">未派彩</font>')+"</td></tr>").appendTo("#query_content")});$(".quotes").html(Paging(a,5,b["count"],2,"queryPage","current",false,"上一页","下一页","首页","尾页"))}else{$('<tr><td colspan="3">未找到相关信息</td></tr>').appendTo("#query_content")}},error:function(c,e,d){var b=1}})}function Paging(k,l,n,c,g,a,h,e,o,j,m){var b="";var f=1;var i=1;var d=Math.floor(n/l);if(n%l>0){d++}if(e==null){j="prev"}if(o==null){o="next"}f=k-c;i=k+c;if(f<=0){i=i-f+1;f=1}if(i>d){i=d}for(count=f;count<=i;count++){if(h){if(count==k){b+='<a class="'+a+'" href="javascript:;" onclick="'+g+"("+count.toString()+');">'+count.toString()+"</a> "}else{b+='<a href="javascript:;" onclick="'+g+"("+count.toString()+');">'+count.toString()+"</a> "}}else{if(count==k){b+='<span class="'+a+'">'+count.toString()+"</span> "}else{b+='<a href="javascript:;" onclick="'+g+"("+count.toString()+');">'+count.toString()+"</a> "}}}if(k-c>1){b=" ... "+b}if(k+c<d){b=b+" ... "}if(k>1){b='<a href="javascript:;" onclick="'+g+"("+(k-1).toString()+');"> '+e+"</a> "+b}if(k<d){b=b+' <a href="javascript:;" onclick="'+g+"("+(k+1).toString()+');">'+o+"</a>"}if(j!=null){if(k>1){b='<a href="javascript:;" onclick="'+g+'(1);">'+j+"</a> "+b}}if(m!=null){if(k<d){b=b+" "+' <a href="javascript:;" onclick="'+g+"("+d.toString()+');">'+m+"</a>"}}return b};