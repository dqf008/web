(function(){var b=0;var c=["webkit","moz"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());(function(a){a.snowfall=function(d,f){var o={flakeCount:35,flakeColor:"#ffffff",flakePosition:"absolute",flakeIndex:999999,minSize:1,maxSize:2,minSpeed:1,maxSpeed:5,round:false,shadow:false,collection:false,collectionHeight:40,deviceorientation:false},f=a.extend(o,f),b=function b(w,i){return Math.round(w+Math.random()*(i-w))};a(d).data("snowfall",this);function h(B,A,z,w,C){this.id=C;this.x=B;this.y=A;this.size=z;this.speed=w;this.step=0;this.stepSize=b(1,10)/100;if(f.collection){this.target=v[b(0,v.length-1)]}var i=null;if(f.image){i=a(document.createElement("img"));i[0].src=f.image}else{i=a(document.createElement("div"));i.css({"background":f.flakeColor})}i.attr({"class":"snowfall-flakes","id":"flake-"+this.id}).css({"width":this.size,"position":f.flakePosition,"top":this.y,"left":this.x,"fontSize":0,"zIndex":f.flakeIndex});if(a(d).get(0).tagName===a(document).get(0).tagName){a("body").append(i);d=a("body")}else{a(d).append(i)}this.element=document.getElementById("flake-"+this.id);this.update=function(){this.y+=this.speed;if(this.y>(q)-(this.size+6)){this.reset()}this.element.style.top=this.y+"px";this.element.style.left=this.x+"px";this.step+=this.stepSize;if(l===false){this.x+=Math.cos(this.step)}else{this.x+=(l+Math.cos(this.step))}if(f.collection){if(this.x>this.target.x&&this.x<this.target.width+this.target.x&&this.y>this.target.y&&this.y<this.target.height+this.target.y){var F=this.target.element.getContext("2d"),E=this.x-this.target.x,D=this.y-this.target.y,G=this.target.colData;if(G[parseInt(E)][parseInt(D+this.speed+this.size)]!==undefined||D+this.speed+this.size>this.target.height){if(D+this.speed+this.size>this.target.height){while(D+this.speed+this.size>this.target.height&&this.speed>0){this.speed*=0.5}F.fillStyle="#fff";if(G[parseInt(E)][parseInt(D+this.speed+this.size)]==undefined){G[parseInt(E)][parseInt(D+this.speed+this.size)]=1;F.fillRect(E,(D)+this.speed+this.size,this.size,this.size)}else{G[parseInt(E)][parseInt(D+this.speed)]=1;F.fillRect(E,D+this.speed,this.size,this.size)}this.reset()}else{this.speed=1;this.stepSize=0;if(parseInt(E)+1<this.target.width&&G[parseInt(E)+1][parseInt(D)+1]==undefined){this.x++}else{if(parseInt(E)-1>0&&G[parseInt(E)-1][parseInt(D)+1]==undefined){this.x--}else{F.fillStyle="#fff";F.fillRect(E,D,this.size,this.size);G[parseInt(E)][parseInt(D)]=1;this.reset()}}}}}}if(this.x>(s)-k||this.x<k){this.reset()}};this.reset=function(){this.y=0;this.x=b(k,s-k);this.stepSize=b(1,10)/100;this.size=b((f.minSize*100),(f.maxSize*100))/100;this.speed=b(f.minSpeed,f.maxSpeed)}}var t=[],c=0,u=0,q=a(d).height(),s=a(d).width(),k=0,x=0;if(f.collection!==false){var g=document.createElement("canvas");if(!!(g.getContext&&g.getContext("2d"))){var v=[],r=a(f.collection),y=f.collectionHeight;for(var u=0;u<r.length;u++){var m=r[u].getBoundingClientRect(),e=document.createElement("canvas"),n=[];if(m.top-y>0){document.body.appendChild(e);e.style.position=f.flakePosition;e.height=y;e.width=m.width;e.style.left=m.left+"px";e.style.top=m.top-y+"px";for(var p=0;p<m.width;p++){n[p]=[]}v.push({element:e,x:m.left,y:m.top-y,width:m.width,height:y,colData:n})}}}else{f.collection=false}}if(a(d).get(0).tagName===a(document).get(0).tagName){k=25}a(window).bind("resize",function(){q=a(d)[0].clientHeight;s=a(d)[0].offsetWidth});for(u=0;u<f.flakeCount;u+=1){c=t.length;t.push(new h(b(k,s-k),b(0,q),b((f.minSize*100),(f.maxSize*100))/100,b(f.minSpeed,f.maxSpeed),c))}if(f.round){a(".snowfall-flakes").css({"-moz-border-radius":f.maxSize,"-webkit-border-radius":f.maxSize,"border-radius":f.maxSize})}if(f.shadow){a(".snowfall-flakes").css({"-moz-box-shadow":"1px 1px 1px #555","-webkit-box-shadow":"1px 1px 1px #555","box-shadow":"1px 1px 1px #555"})}var l=false;if(f.deviceorientation){a(window).bind("deviceorientation",function(i){l=i.originalEvent.gamma*0.1})}function j(){for(u=0;u<t.length;u+=1){t[u].update()}x=requestAnimationFrame(function(){j()})}j();this.clear=function(){a(d).children(".snowfall-flakes").remove();t=[];cancelAnimationFrame(x)}};a.fn.snowfall=function(b){if(typeof(b)=="object"||b==undefined){return this.each(function(c){(new a.snowfall(this,b))})}else{if(typeof(b)=="string"){return this.each(function(c){var d=a(this).data("snowfall");if(d){d.clear()}})}}}})(jQuery);