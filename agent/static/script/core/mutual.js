define(["jquery","popup","utils","cookie","lang"],function($,Popup,utils,cookie,lang){function areaDropdown(e,t){if(e=utils.jq(e),!e)throw Error("下拉控件不存在");if(t=utils.jq(t),!t)throw Error("触发控件的目标控件不存在");t.click(function(t){t.stopPropagation(),"none"==e.css("display")?(e.slideDown(200),$(document).click(function(){e.slideUp(200)})):(e.slideUp(200),$(document).off("click"))}),e.on("click","li",function(){var a=$(this).data("value");a?(t.attr("readonly","readonly"),$.ajax({url:"/home/getcurrency",type:"post",data:{countryNo:a},async:!1,success:function(e){t.val(e.countryAreaCode),t.blur()}})):t.val("").removeAttr("readonly").focus(),e.hide()}),e.find("li[data-value='China']")&&t.val(86)}function getWallet(e,t){var a=[];$(e).length>0&&($(e).each(function(){var e=$(this),i=e.attr(elemCustomAttr.gameClassId);if(i){var n=cookieSetting.lastGetWalletTime+i;if(t){var l=cookie(n);document.cookie=n+"="+l+";expires="+new Date(-1).toGMTString()+";path=/"}utils.validCookieTime(n,"True"==official_cfg.isPoorSite?60:20)&&a.push(i)}}),a.length>0&&new AjaxThread({url:"/account/refreshwallet",data:{gameClassId:a.join(",")},callback:function(t){if(t.success){var a=t.walletList;$(e).each(function(){var t=$(this),i=t.attr(elemCustomAttr.gameClassId);i=i?i:e.indexOf("mainWallet")>=0?0:"";for(var n=0;n<a.length;n++)if(a[n].GameClassID==parseInt(i)){if(0==a[n].MaintainState)t.html("维护中");else{var l;l=a[n].Balance<0?"0.00":void 0==a[n].Balance?a[n].Balance:parseFloat(a[n].Balance).toFixed(2),t.attr(elemCustomAttr.realBalance,l).html(l),$("#onekeyTransForm").find("span[data-id="+i+"]").attr(elemCustomAttr.realBalance,l)}t.data("state",a[n].MaintainState);break}cookie(cookieSetting.lastGetWalletTime+i,new Date)})}else t.success===!1&&$(e).each(function(){var e=$(this),t=e.attr(elemCustomAttr.gameClassId);e.html("0.00"),cookie(cookieSetting.lastGetWalletTime+t,new Date)})}}))}function MatchWithdrawPwd(e,t,a){if(e)var i=dialog.dialog({width:300,title:lang.tipTitle,content:$("#valid-dialog").get(0),fixed:!0,cancelValue:lang.cancelValue,onshow:function(){$("[name=withdrawPwd]").val(""),$(".j-valid-withdrawl").validator({showOk:!1,fields:{withdrawlpwd:$("[name=withdrawlpwd]").data("name")+":required;withdrawalpwd;"},valid:function(e){$.ajax({url:"/account/matchwithdrawpwd",data:$(e).serialize()+"&bankId="+a,type:"POST",success:function(e){e.ErrorCode?dialog.alert(e.ErrorMsg):(i.close(),t(e.memberBankAccount))}})}}),placeholder($(".j-valid-withdrawl").find("[name=withdrawPwd]"))}});else t&&t()}function getMainWallet(e){getWallet(classList.mainWallet,e)}function getChildWallet(e){getWallet(classList.childWallet,e)}function processWallet(e){return e=e<0?"0.00":parseFloat(e).toFixed(2)}function autoGetMainWallet(){setInterval(function(){getMainWallet(!1)},1e3)}function quickTransfer(){$(".j-transLink").on("click",function(){var e,t=($(this).data("id"),dialog.dialog({width:350,title:lang.titleFastExchange,content:$(".j-transForm").get(0),fixed:!0,cancelValue:lang.cancelValue,onshow:function(){$("#transForm").validator({showOk:!1,fields:{amount:lang.labelAmount+":required; integer; range[1~]"},valid:function(a){var i=$("select[name=from]").val(),n=$("select[name=transTo]").val();if(i==n)return void dialog.alert(lang.tipsTheSameWalle);e=$("#game"+i).find(".walletList").attr("data-money");var l=this,o=$(".j-transButton"),r=$("input[name=amount]");l.holdSubmit(),o.removeClass("btn-primary").addClass("btn-default").text(lang.labelInTherTransfer),$.ajax({url:"/account/Transaction",data:$(a).serialize(),type:"POST",success:function(e){if(e.errorCode)dialog.alert(e.errorMsg);else{dialog.msg(e.errorMsg,1e3),$("#refreshWallet").trigger("click");var a=$("#game"+$("select[name=transTo]").val()),i=$("#game"+$("select[name=from]").val());a.find("strong").text((parseFloat(a.text())+parseFloat(r.val())).toFixed(2)),i.find("strong").text((parseFloat(i.find("strong").text())-parseFloat(r.val())).toFixed(2)),r.val(""),t.close()}l.holdSubmit(!1),o.removeClass("btn-default").addClass("btn-primary").text(lang.buttonConfrim)}})}})}}));$("#transForm").trigger("reset"),$("select[name=transTo]").val($(this).data("gameid"))}),$(document).on("keyup","#amount",function(){var e=$(this),t=parseInt($.trim(e.val()),10);!isNaN(t)&&t>0?e.val(t):e.val("")})}function onlineUser(){setInterval(function(){utils.heartbeat(cookieSetting.lastOnlineTime,100,function(){new AjaxThread({url:"/home/onlineuser",callback:function(e){e.success||location.reload()}})})},5e3)}function getMemberMsgCount(e){function t(){new AjaxThread({url:"/account/getinternalmessagecount",callback:function(t){0==t.count?utils.jq(e).hide():utils.jq(e).show(),$(".msg-unread").html("("+t.count+")")}})}$(document).ready(function(){t(),cookie(cookieSetting.unReadMsgCount,new Date)}),setInterval(function(){utils.heartbeat(cookieSetting.unReadMsgCount,"True"==official_cfg.isPoorSite?60:15,function(){t()})},1300)}function AjaxThread(e){function t(e){return e.threadSetting.currentNum<e.threadSetting.maxThread?(e.threadSetting.currentNum++,void a(e)):void e.threadSetting.requestQue.push(e)}function a(e){$.ajax({dataType:e.dataType,url:e.url,type:e.method,data:e.data,async:e.async,error:e.error,success:i})}function i(t){e.callback&&"function"==typeof e.callback&&e.callback(t),e.threadSetting.currentNum--,t.success&&n()}function n(){if(e.threadSetting.currentNum<e.threadSetting.maxThread||e.threadSetting.requestQue.length>0){e.threadSetting.requestQue=e.threadSetting.requestQue.unique();var t=e.threadSetting.requestQue.shift();t&&(e.threadSetting.currentNum++,a(t))}}if(null!=ajaxSetting.threadSetting){if(!this instanceof AjaxThread)return new AjaxThread(e);e=$.extend({},ajaxSetting,e||{}),t(e)}}function SubmitForm(){this.defaults={dialog:null,elements:{form:null,promoCode:null,checkcode:null,checkcodeImg:null,password:null,areaCode:null,areaDropDown:null,phone:null,agreement:null,pwdStrong:null},options:{showOk:!1,rules:{pwdstrong:function(e){return password.isPass(e.value)||lang.tipsPwdWeak}},display:function(e){return e.getAttribute("data-name")||""},fields:{pwd:{rule:"{0}required;password;pwdstrong;"},againPwd:{rule:"match(pwd)"},countryNo:{rule:"{0}required;"},currencyNo:{rule:"{0}required;"},checkcode:{rule:"{0}required;"},realName:{rule:"{0}required;"},areaCode:{rule:"{0}required;"},phone:{rule:"{0}required;"},email:{rule:"email;"},agreement:{rule:"checked"}},groups:null,valid:function(e){}},event:function(){},validation:function(){}}}function activityList(e){$(".j-activityID").on("click",function(e){e.stopPropagation();var t=$(".j-activityUl");"none"==t.css("display")?t.slideDown(200):t.slideUp(200)}),$(".j-activityID").on("keydown",function(e){var t=e.keyCode||e.which;9==t&&$(".j-activityUl").slideUp(200)}),$(document).on("click",function(){$(".listUl").slideUp(200)}),$(document).on("click",".j-activityUl li",function(){var e=$(this),t=e.attr("givemoney");$(".j-activityID").val(e.text()).data("value",e.data("value")?e.text():"暂无优惠"),$(".j-depositForm").find("[name=activityID]").val(e.data("value")).data(e.data("value")),t?$(".j-activityGiveMoney").html("<span style='font-size:16px;'>+</span>"+lang.tipsGiveMoney+t):$(".j-activityGiveMoney").html(""),$(".j-activityUl").hide()})}function renderActivityList(){var e=$(".j-activityUl"),t=$(".j-amount:visible").val(),a=$(".j-bankType").val(),i=$(".j-depositForm");if($(".j-activityGiveMoney").html(""),$(".j-activityID").val(lang.LabelEmpty2).data("value",lang.LabelEmpty2),$(".j-activityID").attr("disabled",!0),i.find("[name=activityID]").val(""),t>0)$.post("/account/GetDepositActivityList",{amount:t,depositType:parseInt(a)+1},function(t){if(t.success){var a="<li value='0' givetype='' giveamount='' givemoney=''>"+lang.LabelEmpty3+"</li>";$.each(t.data,function(e,t){null!=t.ActivityID&&($(".j-activityID").val(lang.LabelEmpty3).data("value",lang.LabelEmpty2),$(".j-activityID").attr("disabled",!1)),a+="<li data-value='"+t.ActivityID+"' givetype='"+t.GiveType+"' giveamount='"+t.GiveAmount+"' givemoney='"+t.GiveMoney+"'>"+t.ActivityName+"</li>"}),e.html(a)}});else{$(".j-activityID").val(lang.LabelEmpty2).data("value",lang.LabelEmpty2);"<li value='0' givetype='' giveamount='' givemoney=''>"+lang.LabelEmpty2+"</li>";$(".j-activityID").attr("disabled",!0)}}function zwDeposit(){function getLimit(e){var t=$(".j-depositForm").data("currencyconfig"),a=0,i=0;switch(e){case 2:a=t.MinAliPayDepositMoney,i=t.MaxAliPayDepositMoney,title="支付宝";break;case 3:a=t.MinWeChatPayDepositMoney,i=t.MaxWeChatPayDepositMoney,title="微信";break;default:a=t.MinQQPayDepositMoney,i=t.MaxQQPayDepositMoney,title="QQ钱包"}return{minMoney:a,maxMoney:i,title:title}}var themeInfoHtml=$(".j-info").html(),isSubmit=!1,isChooseMoney=!1,amount=".j-amount",bankType=".j-bankType";if(activityList(),$("html").hasClass("lte-ie9")&&$.fn.placeholder){var $input=$(".j-amount");$input.placeholder({labelMode:!0,labelStyle:{margin:"12px 0 0 0",left:0,color:"#000","font-size":"14px"}})}$(".j-fast-close").on("click",function(){$(".fast-dialog-title").text($(".fast-dialog-title").data("oldtitle")),$("#j-fast-saving,.fast-dialog-shadow,.j-fast-dialog").fadeOut(300)}),$(".j-change").on("click",function(){var e=$(this).data("type");$(".j-bankType").val(e);var t=getLimit(e);$(".j-moneyUl").find("li").each(function(e){return parseInt($(this).text())>t.maxMoney?($(".j-moneyUl").find("li:gt("+(e-1)+")").hide(),!1):void $(this).show()}),$(this).addClass("change-item-current").siblings().removeClass("change-item-current"),$(".j-amount:eq("+$(".change-item-current").index()+")").show().siblings(".j-amount").hide(),$(".j-depositForm").find(".msg-box").html("").hide(),$(".j-amount").val(""),$(".j-amount:eq("+$(".change-item-current").index()+")").prev("label").show().siblings("label").hide(),renderActivityList()}),$(".j-amount").on("keyup",function(e){var t=$(this);e=window.event||e,37==e.keyCode|39==e.keyCode||t.val(t.val().replace(/[^\d.]/g,"").replace(/^\./g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"))}),$(".j-amount").on("blur",function(){var e=$(this);/(^[1-9]\d*$)|(^([1-9]\d*|0)\.\d{2}$)/g.test(e.val())||/(^[1-9]\d*$)|(^([1-9]\d*|0)\.\d{1}$)/g.test(e.val())||e.val(""),renderActivityList()}),$(".j-amount").on("click",function(e){e.stopPropagation();var t=$(this).siblings(".j-moneyUl");isChooseMoney=!0,"none"==t.css("display")?(t.slideDown(200),$(".listUl").not(t).hide()):t.slideUp(200)}),$(".j-amount").on("keydown",function(e){var t=e.keyCode||e.which;9==t&&$(".j-moneyUl").slideUp(200)}),$(document).on("click",function(){$(".listUl").slideUp(200),$(".j-moneyUl:hidden")&&isChooseMoney&&($(".j-amount:visible").trigger("validate"),isChooseMoney=!1)}),$(document).on("click",".j-moneyUl li",function(){var e=$(this).parent().siblings(".j-amount");e.val($(this).text()),e.trigger("blur"),e.focus(),$(this).parent().hide()}),$(".j-depositForm").validator({showOk:!1,stopOnError:!0,timely:!1,ignore:":hidden",valid:function(form){if(isSubmit)return!1;if(isSubmit=!0,!$(form).find(".j-amount").isValid())return isSubmit=!1,!1;var amountVal=$(form).find(".j-amount:visible").val(),bankTypeVal=parseInt($(form).find(bankType).val()),remark=$(form).find("[name=remark]").val(),limit=getLimit(bankTypeVal),minMoney=limit.minMoney,maxMoney=limit.maxMoney,title=limit.title;return amountVal<minMoney?(dialog.alert(lang.tipsDepositAmountLessThan+minMoney),void(isSubmit=!1)):amountVal>maxMoney?(dialog.alert(lang.tipsDepositAmountMoreThan+maxMoney),void(isSubmit=!1)):void $.ajax({url:"/account/zwsavedeposit",data:{activityID:$(form).find("[name=activityID]").val(),bankType:$(form).find("[name=bankType]").val(),amount:$(form).find(".j-amount:visible").val()},type:"POST",success:function(data){if(success=data.success,$confirm=$(".j-confirm"),0==success){$(".j-fast-dialog").find(".fast-dialog-title").text(title);for(var parms=eval("("+data.returnData+")").Items,infoHtml=themeInfoHtml,qrCode,i=0;i<parms.length;i++)"QrCode"==parms[i].Key?qrCode=parms[i].Value:infoHtml=infoHtml.replace("{"+parms[i].Key+"}",parms[i].Value);infoHtml=infoHtml.replace("{Activity}",$(form).find(".j-activityID").data("value")).replace("{text2}",$(".change-item-current").data("text").text2),$(".j-title").html($(".change-item-current").data("text").text1),$confirm.find(".j-info").html(infoHtml),$confirm.find(".j-qrCode").prop("src",qrCode),$(".j-fast-dialog").removeClass("fast-dialog").addClass("fast-submit-dialog"),$confirm.siblings().not(".fast-dialog-header").hide(),$confirm.show()}else dialog.dialog({title:lang.tipTitle,content:data.returnData,fixed:!0,lock:!0,okValue:lang.labelClose,ok:function(){}});isSubmit=!1}})}}),$("#j-btnSaving").on("click",function(){var e=$(".j-change").length,t=$(".j-fast-content").width(),a=t/e-1;$(".j-depositForm")[0].reset(),$(".j-change").width(a),$(".j-change").removeClass("change-item-current").first().addClass("change-item-current"),$(".j-bankType").val($(".j-change").first().data("type")),$(".j-fast-dialog").hasClass("fast-submit-dialog")&&$(".j-fast-dialog").removeClass("fast-submit-dialog").addClass("fast-dialog"),$(".j-activityGiveMoney").html(""),$("#j-fast-saving,.fast-dialog-shadow,.j-fast-content,.j-fast-item").show(),$(".j-confirm").hide(),$(".j-fast-dialog").fadeIn(300),$(".j-amount").trigger("blur"),$(".j-amount").first().show().prev("label").show().siblings("label").hide(),$(".j-amount:gt(0)").hide(),$(".j-change").first().trigger("click")})}function placeholder(e){e=e||$("input[disable-placeholder]"),$("html").hasClass("lte-ie9")&&$.fn.placeholder&&e.each(function(){var e=$(this).data("options");e&&$(this).placeholder({labelMode:!0,labelStyle:e,labelAlpha:!0})})}var dialog=new Popup,cookieSetting={lastOnlineTime:"lastOnlineTime",lastGetWalletTime:"lastGetWalletTime",demoAccount:"official_tryplay",unReadMsgCount:"unReadMsgCount",memberMsgTime:"memberMsgTime",vaildRedPacketTime:"vaildRedPacketTime",repacketTime:"repacketTime",redPacketId:"redPacketId",memberId:"uid",recommendStatistics:"recommendStatistics"},ajaxSetting={dataType:"json",method:"post",url:null,async:!0,data:null,error:function(e,t,a){401==e.status&&(e.responseJSON.loginFromM?(dialog.alert({id:"sameLogin",content:"账号已登出，请重新登录！"},!0),ajaxSetting.threadSetting=null):location.reload())},alertDialog:function(e){},callback:function(){},threadSetting:{maxThread:100,currentNum:0,requestQue:new Array}},elemCustomAttr={gameClassId:"data-id",realBalance:"data-money"},classList={mainWallet:".mainWallet",childWallet:".childWallet"},password={regex:{strong:new RegExp("^(?=.{6,})(((?=.*[A-Z])(?=.*[a-z])(?=.*[0-9]))|((?=.*[A-Za-z])(?=.*[0-9])(?=.*_))|((?=.*[A-Z])(?=.*[a-z])(?=.*_))).*$"),medium:new RegExp("^(?=.{6,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Za-z])(?=.*_))|((?=.*[A-Za-z])(?=.*[0-9]))|((?=.*_)(?=.*[0-9]))).*$"),enough:new RegExp("^(?=.{6,}).*$")},css:{strong:"ywz_zhuce_hongxian3",medium:"ywz_zhuce_hongxian2",enough:"ywz_zhuce_hongxian",original:"ywz_zhuce_huixian"},target:{enough:$("#passwordLevel_1"),medium:$("#passwordLevel_2"),strong:$("#passwordLevel_3")},strength:function(e){var t=this;utils.jq(e).keyup(function(){for(i in t.regex)if(t.regex.hasOwnProperty(i)){var e=t.regex[i],a=t.css[i],n=t.target[i];if(!a||!n)throw Error("密码强度样式元素不存在");e.test($(this).val())?n.attr("class",a):n.attr("class",t.css.original)}})},isPass:function(e){return this.regex.strong.test(e)||this.regex.medium.test(e)}};SubmitForm.prototype={init:function(e,t){e&&(t===!0?$.extend(!0,this.defaults,this.defaults,e):$.extend(this.defaults,this.defaults,e)),this.defaults.event(),this.validator()},validator:function(){var e=this;this.defaults.elements.form.validator(this.defaults.options).on("validation",function(t,a){e.defaults.validation(t,a)})}},Array.prototype.unique=function(){for(var e,t=[],a={},i=0;null!=(e=this[i]);i++)a[e]||(t.push(e),a[e]=!0);return t},Number.prototype.toFixed=function(e){var t=this+"";if(e||(e=0),t.indexOf(".")==-1&&(t+="."),t+=new Array(e+1).join("0"),new RegExp("^(-|\\+)?(\\d+(\\.\\d{0,"+(e+1)+"})?)\\d*$").test(t)){var t="0"+RegExp.$2,a=RegExp.$1,i=RegExp.$3.length,n=!0;if(i==e+2){if(i=t.match(/\d/g),parseInt(i[i.length-1])>4)for(var l=i.length-2;l>=0&&(i[l]=parseInt(i[l])+1,10==i[l]);l--)i[l]=0,n=1!=l;t=i.join("").replace(new RegExp("(\\d+)(\\d{"+e+"})\\d$"),"$1.$2")}return n&&(t=t.substr(1)),(a+t).replace(/\.$/,"")}return this+""};var checkPhone=function(e,t){var a=!0,i=new Number(""+t).valueOf(),n=e.length,l=e.substr(0,1),o=e.substr(0,2),r=e.substr(0,3);switch(i){case 86:(11!=n||"13"!=o&&"14"!=o&&"15"!=o&&"18"!=o&&"17"!=o)&&(a=!1);break;case 1:10!=n&&(a=!1);break;case 886:"0"==l&&(e=e.substring(1),n=e.length,l=e.substr(0,1)),9==n&&"9"==l||(a=!1);break;case 852:(8!=n||"5"!=l&&"6"!=l&&"9"!=l)&&(a=!1);break;case 853:8==n&&"6"==l||(a=!1);break;case 60:(9!=n&&10!=n||"1"!=l)&&(a=!1);break;case 61:9==n&&"4"==l||(a=!1);break;case 81:(10!=n||"70"!=o&&"80"!=o&&"90"!=o)&&(a=!1);break;case 82:(10!=n||"10"!=o&&"11"!=o&&"16"!=o&&"17"!=o&&"18"!=o&&"19"!=o)&&(a=!1);break;case 850:10==n&&"1"==l||(a=!1);break;case 65:(8!=n||"8"!=l&&"9"!=l)&&(a=!1);break;case 44:var s=e.substr(0,4);(10!=n||"74"!=o&&"75"!=o&&"7624"!=s&&"77"!=o&&"78"!=o&&"79"!=o)&&(a=!1);break;case 33:(9!=n||"6"!=l&&"73"!=o&&"74"!=o&&"75"!=o&&"76"!=o&&"77"!=o&&"78"!=o)&&(a=!1);break;case 7:(10!=n||"91"!=o&&"92"!=o&&"93"!=o&&"96"!=o&&"98"!=o&&"99"!=o&&"901"!=r&&"902"!=r&&"903"!=r&&"904"!=r&&"905"!=r&&"906"!=r&&"908"!=r&&"909"!=r&&"950"!=r&&"951"!=r&&"952"!=r&&"953"!=r)&&(a=!1);break;case 91:(10!=n||"7"!=l&&"8"!=l&&"9"!=l)&&(a=!1);break;case 66:"0"==l&&(e=e.substring(1),n=e.length,l=e.substr(0,1)),(9!=n||"8"!=l&&"9"!=l)&&(a=!1);break;case 49:(10!=n&&11!=n&&9!=n||"15"!=o&&"16"!=o&&"17"!=o)&&(a=!1);break;case 55:10!=n&&11!=n&&(a=!1);break;case 62:(9!=n&&10!=n&&11!=n||"8"!=l)&&(a=!1);break;case 855:8!=n&&9!=n&&10!=n&&(a=!1);break;case 95:(8!=n&&9!=n||"69"!=o&&"80"!=o&&"90"!=o&&"99"!=o)&&(a=!1);break;case 673:(7!=n&&8!=n||"85"!=o&&"86"!=o&&"87"!=o&&"88"!=o)&&(a=!1);break;case 63:10==n&&"9"==l||(a=!1);break;case 84:(9!=n&&10!=n||"9"!=l)&&(a=!1);break;case 856:(9!=n&&10!=n||"20"!=o)&&(a=!1)}return a};return{cookieSetting:cookieSetting,password:password,areaDropdown:areaDropdown,getMainWallet:getMainWallet,getChildWallet:getChildWallet,autoGetMainWallet:autoGetMainWallet,quickTransfer:quickTransfer,onlineUser:onlineUser,getMemberMsgCount:getMemberMsgCount,AjaxThread:AjaxThread,SubmitForm:SubmitForm,zwDeposit:zwDeposit,placeholder:placeholder,MatchWithdrawPwd:MatchWithdrawPwd,checkPhone:checkPhone}});