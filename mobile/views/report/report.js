angular.module("ionicz.controllers").controller("ReportBaseCtrl",["$scope","$rootScope","ionicDatePicker","Tools",function(a,b,c){a.baseDatePicker=function(a,b){angular.isUndefined(a)&&(a={}),c.openDatePicker({callback:function(a){angular.isFunction(b)&&b(moment(a).format("YYYY-MM-DD"))},closeOnSelect:!0,showTodayButton:!1,from:a.fromDate?moment(a.fromDate)._d:moment().subtract(5,"years").add(1,"day")._d,to:a.toDate?moment(a.toDate)._d:moment()._d,inputDate:a.inputDate?moment(a.inputDate)._d:moment()._d})},!b.appData.report&&(b.appData.report={})}]).controller("ReportCtrl",["$scope","$rootScope","$location","Tools",function(a,b,c,d){var e=["Sports","Lottery"];a.back=d.back("/ucenter/index"),a.GameType={},a.type=function(a){for(var b=0;b<e.length;b++)if(e[b]==a)return b;return 0}(c.search().type||e[0]),a.GameList={},a.StartDate=moment().subtract(6,"days").format("YYYY-MM-DD"),a.EndDate=moment().format("YYYY-MM-DD"),a.$on("$ionicView.beforeEnter",function(){b.appData.report.list?a.GameList=b.appData.report.list:d.ajax({method:"POST",url:"ajax.php",params:{action:"report",type:"list"},success:function(c){c&&1==c.status&&(a.GameList=c.msg,b.appData.report.list=c.msg)}})}),a.openDatePicker=function(b){!b||a.baseDatePicker({fromDate:"EndDate"==b?a["StartDate"]:!1,toDate:"StartDate"==b?a["EndDate"]:!1,inputDate:a[b]},function(c){a[b]=c})},a.onChange=function(b){a.type=b},a.report=function(){b.appData.report.cache={Start:a.StartDate,End:a.EndDate,Type:e[a.type],GameType:a.GameType[e[a.type]],GameName:a.GameList[e[a.type]][a.GameType[e[a.type]]]},c.path("/report/list")}}]).controller("ReportListCtrl",["$scope","$rootScope","$location","$timeout","Tools",function(a,b,c,d,e){var f=0,g=1,h=10;a.back=e.back("/report/index"),a.ansycLoaded=!1,a.sports=!1,a.loadMore=!1,a.isRefresh=!1,a.isLoading=!0,a.appData=b.appData.report.cache,a.betListData=[],a.allData={totalBetNums:0,winLoseMoney:0},a.refresh=function(){a.loadMore=!1,a.isRefresh=!0,a.betListData=[],f=0,g=1,a.load()},a.load=function(){a.isLoading=!0,e.ajax({method:"POST",url:"ajax.php",params:{action:"report",type:a.appData.Type,gameType:a.appData.GameType,start:a.appData.Start,end:a.appData.End,page:g,rows:h,lastId:f},success:function(b){a.isRefresh&&a.$broadcast("scroll.refreshComplete"),a.ansycLoaded=!0,a.isRefresh=!1,b&&1==b.status?(a.sports=b.sports,a.betListData=a.betListData.concat(b.msg),a.allData.totalBetNums=b.totalCount,a.allData.winLoseMoney=b.totalMoney,f=b.lastId,h*g<b.totalCount?(a.loadMore=!0,g++,d(function(){a.isLoading=!1},1e3)):(a.loadMore=!1,a.isLoading=!1)):(a.betListData=[],a.isLoading=!1,f=0),a.$broadcast("scroll.infiniteScrollComplete")}}),a.isRefresh||a.$broadcast("scroll.infiniteScrollComplete")},a.showDetail=function(b){a.detail=a.betListData[b],a.detail.mdTime=a.detail.date+" "+a.detail.time,a.detail.bjTime=moment(a.detail.mdTime).add(12,"hours").format("YYYY-MM-DD HH:mm:ss"),a.detail.color="",0==a.detail.status?a.detail.show="未结算":(a.detail.show="已结算-",0==a.detail.winLoseMoney?a.detail.show+="和局":a.detail.winLoseMoney>0?(a.detail.color="#00b939",a.detail.show+="赢"):(a.detail.color="#e00013",a.detail.show+="输")),e.modal({scope:a,title:"注单详情",templateUrl:a.sports?"sports-detail-template":"detail-template"})},a.$on("$ionicView.afterEnter",function(){a.appData&&a.appData.Type&&a.appData.GameType?a.load():c.path("/report/index")})}]);