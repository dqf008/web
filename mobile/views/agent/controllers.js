angular.module("ionicz.agent").controller("AgentBaseCtrl",["$scope","$rootScope","Tools",function(a,b,c){a.back=c.back("/home"),b.appData.agent||c.ajax({method:"POST",url:"../agent/ajax.php",params:{action:"GetContent"},success:function(a){a&&0==a.errorCode&&(b.appData.agent=a.errorMsg)}})}]).controller("AgentCtrl",["$scope","$rootScope","$location","Tools","My",function(a,b,c,d,e){a.Join=function(){a.isLogin?c.path("/agent/join"):d.alert(["系统提示","请登录账号后再使用该功能"])},a.$on("$ionicView.beforeEnter",function(){e.getAgent()&&c.path("/agent/myrec")})}]).controller("AgentJoinCtrl",["$scope","$rootScope","$location","Tools","My",function(a,b,c,d,e){var f;a.Agree=function(){a.isLogin?d.ajax({method:"POST",url:"../agent/ajax.php",params:{action:"apply",msg:f},backdrop:!0,success:function(b){if(f=null,b)if(1==b.errorCode)var g=d.modal({title:"请填写申请理由",template:'<div class="row"><div class="col"><div class="item item-input"><textarea style="resize:none;width:100%;height:100px" ng-model="modalData.ApplyMsg"></textarea></div></div></div>',callback:function(b){return!b.modalData.ApplyMsg||b.modalData.ApplyMsg.length<20?(d.tip("请填写合适的申请理由"),!1):(g.close(),f=b.modalData.ApplyMsg,a.Agree(),!0)}});else 0==b.errorCode?(e.info.agent=!0,d.alert(["系统提示",b.errorMsg],function(){c.path("/agent/myrec")})):d.alert(["系统提示",b.errorMsg],function(){e.getAgent()&&c.path("/agent/myrec")});else d.alert(["系统提示","请求超时"])}}):d.alert(["系统提示","请登录账号后再使用该功能"])}}]).controller("AgentMyrecCtrl",["$scope","$rootScope","$ionicHistory","$location","Tools",function(a,b,d,e,f){var g=1;!d.backView()||"agent.index"!=d.backView().stateId&&"agent.join"!=c.backView().stateId||d.removeBackView(),a.ansycLoaded=!1,a.moreDataCanBeLoaded=!1,a.bankData=[],a.tabIndex=1,a.recommendUrl="",a.TotalClassName="",a.recommendData={total:0,"7days":0,"30days":0,m_yesterday:"0.00",m_7days:"0.00",m_30days:"0.00",w_yesterday:"0.00",w_7days:"0.00",w_30days:"0.00",c_yesterday:"0.00",c_7days:"0.00",c_30days:"0.00",q_yesterday:"0.00",q_7days:"0.00",q_30days:"0.00"},a.detailParam={days:"7"},a.detailData={List:[]},a.Total={rowCount:0,money:0},a.$on("$ionicView.beforeEnter",function(){f.ajax({method:"POST",url:"ajax.php",params:{action:"bank",type:"get"},backdrop:!0,success:function(b){b&&1==b.status&&(a.bankData=b.msg,f.ajax({method:"POST",url:"../agent/ajax.php",params:{action:"getstatistics"},backdrop:!0,success:function(b){b&&0==b.errorCode&&(a.recommendUrl=b.errorMsg,a.recommendData=b,a.loadMoreData())}}))}})}),a.SelectTab=function(b){a.tabIndex=b},a.loadMoreData=function(){f.ajax({method:"POST",url:"../agent/ajax.php",params:{action:"getreports",page:g,days:a.detailParam.days},backdrop:!0,success:function(b){a.ansycLoaded=!0,b&&!b.errorCode&&(console.log(b,!b.errorCode),b.currentPage>b.pageCount?(a.moreDataCanBeLoaded=!0,g++):a.moreDataCanBeLoaded=!1,a.detailData.List=a.detailData.List.concat(b.list),a.Total.rowCount+=b.total.count,a.Total.money+=parseFloat(b.total.money),a.TotalClassName="table-footer"+(a.detailData.List.length>4?"4":a.detailData.List.length))}})},a.onChange=function(){a.ansycLoaded=!1,a.TotalClassName="",a.detailData.List=[],a.Total={rowCount:0,money:0},g=1,a.loadMoreData()},a.showDetail=function(b){a.detail=a.detailData.List[b],f.modal({scope:a,title:a.detailData.List[b].reportTime+" 统计详情",templateUrl:"detail-template",css:"team-detail info-mdf"})}}]).controller("AgentTermsCtrl",function(){});