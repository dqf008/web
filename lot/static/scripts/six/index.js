define(["app/common/lottery","app/common/sound"],function(a,b){"use strict";var c,d=null,e=null;return c=a.extend({initialize:function(a){var b=this,d=_.extend({hln:!0,cookieKey:"hkc_QuickMode"},a);c.superclass.initialize.call(this,d),this.refreshTimer=new this.CountDown(10),$(function(){b.options.lotteryPan=$("#h-nav-top").val(),b.options.panType=$("#h-nav-sub").val(),b.ballTpl=$("#tpl-jslh-prev-balls").html(),b.refresh(),b.highlightNav()})},closeTimer:function(a){function b(a){var b;b=e.utils.secondsFormat(a),c.text(b.minutes+":"+b.seconds)}var c=$("#close-timer"),e=this;e.lang.date,null!=d&&d.stop(),a?(d=new e.CountDown(a),d.update=function(a){b(a)},d.done=function(){e.close(),c.text(e.lang.msg.closedGate)},d.start(),e.isOpen||e.open()):(e.close(),c.text(e.lang.msg.closedGate))},openTimer:function(a){function b(a){var b;b=d.utils.secondsFormat(a,!0),c.text(b)}var c=$("#award-timer"),d=this;d.lang.date,null!=e&&e.stop(),a?(e=new d.CountDown(Math.abs(a)+5),e.update=function(a){b(a)},e.done=function(){d.close(),c.text("00:00"),d.refresh()},e.start()):(d.close(),c.text("00:00"))},afterBet:function(){this.reset(),this.refresh()},close:function(){this.reset(),c.superclass.close.call(this)},_updateLines:function(a){this.isOpen&&this.$doc.find("[data-id]:not(button)").each(function(){var f,g,b=$(this),c=b.attr("data-id"),d=b.attr("data-oid"),e=b.attr("data-odds");d&&(c=d),c&&(f=a["j"+c],f="undefined"!=typeof f?f.toString():"0","undefined"!=typeof e?(b.attr("data-odds",f),null!=f&&""!=f&&-1!=f.indexOf("/")&&(g=f.split("/"),b.attr("data-sub-odds",g[1]))):b.text(f))})},highlightNav:function(){var a={top:$("#h-nav-top").val(),sub:$("#h-nav-sub").val()},b=$("#play-tab").find("a"),c=$("#sub-tabs").find("a"),d="current";"0"!==a.top?b.removeClass(d).filter("#nav-"+a.top).addClass(d):b.eq(0).addClass(d),c.length?("0"!==a.sub?c.removeClass(d).filter("#sub-nav-"+a.sub).addClass(d):c.eq(0).addClass(d),this.options.category=$.trim(c.filter("."+d).text())):this.options.category=$.trim(b.filter("."+d).text())},afterRefresh:function(a){var d,b=this,c=a.CloseCountdown;b.closeTimer(0>=c?0:c),d=a.OpenCountdown,b.openTimer(0>=d?0:d),this.refreshTimer.update=function(){},this.refreshTimer.done=function(){b.refresh()},this.refreshTimer.restart(),this._updateLines(a.Lines)},getPreBall:function(a){var c=this,d=c.ballTpl,e=c.tpl.to_html(d,{balls:a.PreResult}),f=a.LotterNo;e&&$("#prev-bs").html(e),$("#prev-bs").children().last().before('<i class="icon plus-icon"></i>'),$("#prev-issue").text(f),$("#current-issue").text('***'+a.CurrentPeriod.substring(a.CurrentPeriod.length-5)+c.lang.msg.issue).attr("title",a.CurrentPeriod+c.lang.msg.issue),null!=c.PrePeriodNumber&&c.PrePeriodNumber!=f&&c.isSoundOn&&b.play(),c.PrePeriodNumber=f},getBetInfo:function(){var a=this,b={action:"info",type:"lines",lotteryId:a.lotteryId,lotteryPan:a.options.lotteryPan,panType:a.options.panType};return this.utils.ajax({url:"ajax.php",data:JSON.stringify(b),success:function(b){b.Success?a.updateAmount():a.ui.error(b.Msg),b.ExtendObj&&!b.ExtendObj.IsLogin&&a.onAuthFail()}})}})});