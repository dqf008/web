define(["six/index"],function(t){var e=t.extend({initialize:function(t){var i=this,n=_.extend({ballTpl:"",sx:null,useCategoryAsName:!0,Lines:0,SubLines:0,},t);e.superclass.initialize.call(this,n),this.isQuickMode=!0,this._betType=1,this.$betContainer=$(),this.$betTable=$("#j-bet-tb"),this.danNumber=null,this.tuoNumber=null;var s=this.options.limit;this._region={min:s,max:10,group:s},this._limiMsg=this.utils.format(this.lang.msg.limit,this._region.min+"-"+this._region.max),this.listenAmount(),$(function(){i._init()})},_updateLines:function(t){var e=this,j=t["j"+e.options.panType+"00"],a=j.toString().split("/"),h=a.length>1,o=$("[data-odds]"),s;e.options.Lines=parseFloat(a[0]),s=$("#j-odds").text(e.isOpen?j:"--").siblings("span"),h&&(e.options.SubLines=parseFloat(a[0]),e.options.Lines=parseFloat(a[1]),s.text(t["tips"]+e.options.lang.tipsPeilv),o.attr("data-sub-odds",e.options.SubLines)),o.attr("data-odds",e.options.Lines)},_init:function(){function t(t,i){var n=!1;return e.$betContainer.find(".input").not(i).each(function(){if($(this).val()==t){return n=!0,!1}}),n}var e=this;e.$checkbox=e.$doc.find(":checkbox"),this.$betRadios=$("#j-cpd-tb").find(":radio"),this.$betCondition=$("#j-bet-tb").find("tr.hide"),e.listenAmount(),e.$checkbox.on("change",function(){if(2==e._betType){var t=e.$checkbox.filter(":disabled").length,i=e.$betContainer.find("input"),n=3==e._region.group||4==e._region.group,s=$(this).data("number")+"";0==t&&(e.danNumber=s,i.eq(0).val(e.danNumber),$(this).prop("disabled",!0)),n&&1==t&&(e.tuoNumber=s,i.eq(1).val(e.tuoNumber),$(this).prop("disabled",!0))}e.records.length<e._region.max?e.getData():((this.checked||e.records.length!=e._region.max)&&(e.ui.msg(e._limiMsg),$(this).prop("checked",!1)),e.getData())}),e.$doc.on("click",".j-content tbody td",function(){var t=$(this),h=t.hasClass("table-current");!t.hasClass("table-odd")&&(t=t.prev()),t=t.nextAll().andSelf().slice(0,2).find(":checkbox"),!t.prop("disabled")&&t.prop("checked")==h&&t.prop("checked",!h).trigger("change")}),this.$betRadios.on("change",function(){e._getBetType($(this))}),this.$betRadios.eq(0).prop("checked",!0).trigger("change"),this.$doc.on("blur",".j-left-num,.j-right-num",function(){var i=$(this).val();i&&t(i,$(this))&&(e.ui.msg(e.lang.msg.sameNumbers),$(this).val(""))})},_getBetType:function(t){var e,i=parseInt(t.data("type"),10),n=t.data("process");n&&(this.processor=n,i&&(e=i-1,this._betType=i,this.$betContainer=this.$betCondition.eq(e),this.$betCondition.hide(),this.$betContainer.show(),this.reset(),1!=this._betType&&2!=this._betType&&this.$checkbox.prop("disabled",!0)))},_getInfoByElement:function(t){var e=t.attr("data-id"),i=parseInt(t.attr("data-oid"),10),n=parseFloat(t.attr("data-odds")),s=$.trim(t.closest("td").prev(".table-odd").text()),o=parseFloat(t.attr("data-sub-odds")),r=t.attr("data-key"),a=this.options.category;return{category:a,name:s,id:e,key:r,oddsId:i,odds:n,subOdds:o,amount:this.amount}},getRecordsHtml:function(){function t(){return _.pluck(o.records,"name")}var e,i,n,s,o=this,g,r=$("#tpl-confirm-group").html(),a=null;1==this._betType&&(e=[t().join(",")],i=this.utils.combination(this.records,this._region.min),n=i.length),2==this._betType&&(a={},a.t=_.without(t(),this.danNumber,this.tuoNumber).join(","),3==this._region.group||4==this._region.group?(g=_.map(this.records,function(t){return t.name!=o.danNumber&&t.name!=o.tuoNumber}),g=this.utils.combination(_.compact(g),this._region.group-2),n=g.length,a.d=this.danNumber+","+this.tuoNumber):(n=this.records.length-1,a.d=this.danNumber)),1!=this._betType&&2!=this._betType&&(n=_.reduce(this.records,function(t,e){return t*e.length},1),s=_.groupBy(_.map(this.records,function(t){return _.pluck(t,"name").join(",")}),function(t,e){return e%2==0?"left":"right"}));var h={category:this.options.category,dan:a,name:e,desc:s,group:n,single:this.amount.toFixed(2),total:(n*this.amount).toFixed(2)};return this.betTotal=h.total,this.tpl.to_html(r,h)},reset:function(){this.$checkbox.prop({"checked":!1,"disabled":!1}),this.$doc.find("td").removeClass("table-current"),this.danNumber=null,this.tuoNumber=null,this.$betTable.find(":checked").prop("checked",!1),this.$betTable.find(".input").val(""),1!=this._betType&&2!=this._betType&&(this.$checkbox.prop("disabled",!0)),$(".j-reset-html").html(""),e.superclass.reset.call(this)},_defaultValidator:function(){var t=this.records.length;return !(t<this._region.min||t>this._region.max)||(this.ui.msg(this._limiMsg),!1)},_commonValidator:function(t,e){var i=this.records,n=i[0],s=i[1];return n&&s&&n.length&&s.length?!_.isEqual(n,s)||(this.ui.msg(e),!1):(this.ui.msg(t),!1)},_dtValidator:function(){return this._defaultValidator()},_sxValidator:function(){return this._commonValidator(this.options.lang.tipsDuiPengSX,this.options.lang.tipsDuiPengSxSame)},_wsValidator:function(){return this._commonValidator(this.options.lang.tipsDuiPengWeiShu,this.options.lang.tipsDuiPengWeiShuSame)},_swValidator:function(){return this._commonValidator(this.options.lang.tipsDuiPengSxWeiShu,this.options.lang.tipsDuiPengSxWeiShuSame)},_ryValidator:function(){return this._commonValidator(this.options.lang.tipsDuiPengAnyNum,this.options.lang.tipsDuiPengAnyNumSame)},valid:function(){var t,e=this["_"+this.processor+"Validator"];return e&&(t=e.call(this)),!!t&&(!!this.amount||(this.ui.msg(this.lang.msg.emptyAmount),!1))},getData:function(){var e={Id:0,BetContext:[]},i=this["_"+this.processor+"Processor"];this.$doc.find("td").removeClass("table-current"),this.$checkbox.filter(":checked").map(function(){$(this).parents("td").prev().andSelf().addClass("table-current")}),i&&(e=i.call(this)),o=this;this.data=_.map(e,function(t){return $.extend({Id:0,BetContext:[],Lines:o.options.Lines,BetType:o.options.BetType,IsForNumber:!0,IsTeMa:!1,Money:o.amount},t)}),this.data,e},_getOddsByItem:function(t){if(t){var e={BetContext:t.name,Id:parseFloat(t.key),Lines:parseFloat(t.odds)};return t.subOdds&&(e.SubLines=parseFloat(t.subOdds)),e}},_defaultProcessor:function(){var t,e,s,o=this,i,r=this._region.group,a=this.options,h=this.$betContainer;return a.BetType=5,this.records=this.$checkbox.filter(":checked").map(function(){return o._getInfoByElement($(this))}).get(),s=_.map(this.records,function(t){return i||(i=parseFloat(t.id)),o._getOddsByItem(t)}),e=this.utils.combination(s,r),t=_.pluck(this.records,"name"),h.find("td").html(this.tpl.to_html($("#tpl-cpd").html(),{total:t.length,items:t.join(" "),group:e.length})),_.map(e,function(t){return{BetContext:t,Id:i}})},_dtProcessor:function(){var t,e,i=this,d,n=this._region.group,s=4==n||3==n?2:1;this.options.BetType=n;this.records=this.$checkbox.filter(":checked").map(function(){return i._getInfoByElement($(this))}).get();t=3==n||4==n?_.filter(this.records,function(t){return t.name==i.danNumber||t.name==i.tuoNumber}):[_.find(this.records,{name:i.danNumber})],{name:i.danNumber},i;var r=_.map(this.records,function(t){if(t.name!=i.danNumber&&((3!=n&&4!=n)||t.name!=i.tuoNumber)){return e||(e=t.id),i._getOddsByItem(t)}}),g=this.utils.combination(_.compact(r),n-s);var o=_.pluck(this.records,"name");this.$betContainer.find("td div").html(this.tpl.to_html($("#tpl-cpd").html(),{total:o.length,items:o.join(" "),group:g.length}));var a=_.map(t,function(t){return d||(d=parseFloat(t.id)),i._getOddsByItem(t)});return _.map(g,function(t){var b=$.merge([],a);return{BetContext:$.merge(b,t),Id:d}})},_commonProcessor:function(t,e){function i(t){return l.$betContainer.find(t).map(function(){var t=parseInt("0"+$.trim($(this).val()),10);if(t>0){return t}})}function n(t){var e=_.map(t,function(t){return'[data-number="'+t+'"]'}).join(",");return l.$checkbox.filter(e).map(function(){return l._getInfoByElement($(this))}).get()}var s,o,r,a,h,u,c,d,l=this;if(this.records.length=0,e){o=i(".j-left-num"),s=i(".j-right-num"),u=n(o),c=n(s)}else{if(r=this.$betContainer.find(":checked"),o=$.trim(r.eq(0).val()),s=$.trim(r.eq(1).val()),!o||!s){return null}o=t[o],s=t[s],"sw"==l.processor&&_.each(o,function(t){_.contains(s,t)&&(s=_.without(s,t))}),u=n(o),c=n(s)}return this.records.push(u),this.records.push(c),a=[],_.map(u,function(t){return h=l._getOddsByItem(t),_.map(c,function(t){d=l._getOddsByItem(t);return a.push({BetContext:[h,d],Id:h.Id})}),!1}),a},_sxProcessor:function(){return this.options.BetType=6,this._commonProcessor(this.options.sx)},_wsProcessor:function(){return this.options.BetType=6,this._commonProcessor(this.options.ws)},_swProcessor:function(){this.options.BetType=6;var t=$.extend({},this.options.sx,this.options.ws);return this._commonProcessor(t)},_ryProcessor:function(){this.options.BetType=6;var t=$.extend({},this.options.sx,this.options.ws);return this._commonProcessor(t,!0)}});return e});