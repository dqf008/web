define(["app/common/lottery"],function(t){"use strict";var e,s=null;return e=t.extend({initialize:function(t){var s=this,n=_.extend({hln:!0,cookieKey:"hkc_QuickMode"},t);e.superclass.initialize.call(this,n),this.refreshTimer=new this.CountDown(this.refreshDuration),$(function(){s.options.lotteryPan=$("#h-nav-top").val(),s.options.panType=$("#h-nav-sub").val(),s.ballTpl=$("#tpl-prev-balls").html(),s.refresh(),s.highlightNav()})},closeTimer:function(t){function e(t){var e,s;s=i.utils.secondsFormat(t),_.map(a,function(t,e){var n=s[e];n>0?s[e]=s[e]+t:s[e]=null}),e=i.tpl.to_html("{{days}}{{hours}}{{minutes}}{{seconds}}",s),n.text(e)}var n=$("#close-timer"),i=this,a=i.lang.date;null!=s&&s.stop(),t?(s=new i.CountDown(t),s.update=function(t){e(t)},s.done=function(){i.close(),n.text(i.lang.msg.closedGate)},s.start(),i.isOpen||i.open()):(i.close(),n.text(i.lang.msg.closedGate))},afterBet:function(){this.reset(),this.refresh()},_updateLines:function(t){this.isOpen&&this.$doc.find("[data-id]").each(function(){var e=$(this),s=e.attr("data-id"),n=e.attr("data-oid"),i=e.attr("data-odds");if(n&&(s=n),s){var a=t["j"+s];if("undefined"!=typeof i){if(e.attr("data-odds",a),null!=a&&""!=a&&a.indexOf("/")!=-1){var r=a.split("/");e.attr("data-sub-odds",r[1])}}else e.text(a)}})},highlightNav:function(){var t={top:$("#h-nav-top").val(),sub:$("#h-nav-sub").val()},e=$("#play-tab").find("a"),s=$("#sub-tabs").find("a"),n="current";"0"!==t.top?e.removeClass(n).filter("#nav-"+t.top).addClass(n):e.eq(0).addClass(n),s.length?("0"!==t.sub?s.removeClass(n).filter("#sub-nav-"+t.sub).addClass(n):s.eq(0).addClass(n),this.options.category=$.trim(s.filter("."+n).text())):this.options.category=$.trim(e.filter("."+n).text())},afterRefresh:function(t){var e=this,s=t.CloseCountdown;e.closeTimer(s<=0?0:s),this.refreshTimer.update=function(t){},this.refreshTimer.done=function(){e.refresh()},this.refreshTimer.restart(),this._updateLines(t.Lines)},getPreBall:function(t){var e=this.ballTpl,s=this.tpl.to_html(e,{balls:t.PreResult});s&&$("#prev-bs").html(s),$("#prev-bs").children().last().before('<i class="icon plus-icon"></i>'),$("#prev-issue").text(t.LotterNo)},getBetInfo:function(){var t=this,e={action:"info",type:"lines",lotteryId:t.lotteryId,lotteryPan:t.options.lotteryPan,panType:t.options.panType};return this.utils.ajax({url:"ajax.php",data:JSON.stringify(e),success:function(e){e.Success?t.updateAmount():t.ui.error(e.Msg),e.ExtendObj&&!e.ExtendObj.IsLogin&&t.onAuthFail()}})}})});