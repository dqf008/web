define(["jquery"],function(t){function e(e,i,o,n){i=i||3e3,"string"===t.type(i)&&(o=i,i=3e3);var s=r({id:"d-msg",skin:"ui-msg "+o,content:e});setTimeout(function(){s.remove()},i);return s.show(),s}var i=function(t){function e(){this.destroyed=!1,this.__popup=t("<div />").attr({tabindex:"-1"}).css({display:"none",position:"absolute",outline:0}).html(this.innerHTML).appendTo("body"),this.__backdrop=t("<div />"),this.node=this.__popup[0],this.backdrop=this.__backdrop[0],i++}var i=0,o=!("minWidth"in t("html")[0].style),n=!o;return t.extend(e.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",backdropBackground:"#fff",backdropOpacity:0,innerHTML:"",className:"ui-popup",show:function(e){if(this.destroyed)return this;var i=this,n=this.__popup;return this.__activeElement=this.__getActive(),this.open=!0,this.follow=e||this.follow,this.__ready||(n.addClass(this.className),this.modal&&this.__lock(),n.html()||n.html(this.innerHTML),o||t(window).on("resize",this.__onresize=function(){i.reset()}),this.__ready=!0),n.addClass(this.className+"-show").attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute").show(),this.__backdrop.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(t){return!this.destroyed&&this.open&&(void 0!==t&&(this.returnValue=t),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove"),e.current===this&&(e.current=null),this.__unlock(),this.__popup.remove(),this.__backdrop.remove(),o||t(window).off("resize",this.__onresize),this.__dispatchEvent("remove");for(var i in this)delete this[i];return this},reset:function(){var t=this.follow;return t?this.__follow(t):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var i=this.node,o=e.current;if(o&&o!==this&&o.blur(!1),!t.contains(i,this.__getActive())){var n=this.__popup.find("[autofocus]")[0];!this._autofocus&&n?this._autofocus=!0:n=i,this.__focus(n)}return e.current=this,this.__popup.addClass(this.className+"-focus"),this.__zIndex(),this.__dispatchEvent("focus"),this},blur:function(){var t=this.__activeElement,e=arguments[0];return e!==!1&&this.__focus(t),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(t,e){return this.__getEventListener(t).push(e),this},removeEventListener:function(t,e){for(var i=this.__getEventListener(t),o=0;o<i.length;o++)e===i[o]&&i.splice(o--,1);return this},__getEventListener:function(t){var e=this.__listener;return e||(e=this.__listener={}),e[t]||(e[t]=[]),e[t]},__dispatchEvent:function(t){var e=this.__getEventListener(t);this["on"+t]&&this["on"+t]();for(var i=0;i<e.length;i++)e[i].call(this)},__focus:function(t){try{this.autofocus&&!/^iframe$/i.test(t.nodeName)&&t.focus()}catch(t){}},__getActive:function(){try{var t=document.activeElement,e=t.contentDocument,i=e&&e.activeElement||t;return i}catch(t){}},__zIndex:function(){var t=e.zIndex++;this.__popup.css("zIndex",t),this.__backdrop.css("zIndex",t-1),this.zIndex=t},__center:function(){var e=this.__popup,i=t(window),o=t(document),n=this.fixed,s=n?0:o.scrollLeft(),r=n?0:o.scrollTop(),a=i.width(),c=i.height(),h=e.width(),l=e.height(),d=(a-h)/2+s,u=382*(c-l)/1e3+r,f=e[0].style;f.left=Math.max(parseInt(d),s)+"px",f.top=Math.max(parseInt(u),r)+"px"},__follow:function(e){var i=e.parentNode&&t(e),o=this.__popup;if(this.__followSkin&&o.removeClass(this.__followSkin),i){var n=i.offset();if(n.left*n.top<0)return this.__center()}var s=this,r=this.fixed,a=t(window),c=t(document),h=a.width(),l=a.height(),d=c.scrollLeft(),u=c.scrollTop(),f=o.width(),p=o.height(),_=i?i.outerWidth():0,v=i?i.outerHeight():0,m=this.__offset(e),g=m.left,b=m.top,w=r?g-d:g,y=r?b-u:b,k=r?0:d,x=r?0:u,E=k+h-f,C=x+l-p,L={},z=this.align.split(" "),I=this.className+"-",N={top:"bottom",bottom:"top",left:"right",right:"left"},T={top:"top",bottom:"top",left:"left",right:"left"},$=[{top:y-p,bottom:y+v,left:w-f,right:w+_},{top:y,bottom:y-p+v,left:w,right:w-f+_}],M={left:w+_/2-f/2,top:y+v/2-p/2},V={left:[k,E],top:[x,C]};t.each(z,function(t,e){$[t][e]>V[T[e]][1]&&(e=z[t]=N[e]),$[t][e]<V[T[e]][0]&&(z[t]=N[e])}),z[1]||(T[z[1]]="left"===T[z[0]]?"top":"left",$[1][z[1]]=M[T[z[1]]]),I+=z.join("-")+" "+this.className+"-follow",s.__followSkin=I,i&&o.addClass(I),L[T[z[0]]]=parseInt($[0][z[0]]),L[T[z[1]]]=parseInt($[1][z[1]]),o.css(L)},__offset:function(e){var i=e.parentNode,o=i?t(e).offset():{left:e.pageX,top:e.pageY};e=i?e:e.target;var n=e.ownerDocument,s=n.defaultView||n.parentWindow;if(s==window)return o;var r=s.frameElement,a=t(n),c=a.scrollLeft(),h=a.scrollTop(),l=t(r).offset(),d=l.left,u=l.top;return{left:o.left+d-c,top:o.top+u-h}},__lock:function(){var i=this,o=this.__popup,s=this.__backdrop,r={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",opacity:0,background:this.backdropBackground};o.addClass(this.className+"-modal"),e.zIndex=e.zIndex+2,this.__zIndex(),n||t.extend(r,{position:"absolute",width:t(window).width()+"px",height:t(document).height()+"px"}),s.css(r).animate({opacity:this.backdropOpacity},150).insertAfter(o).attr({tabindex:"0"}).on("focus",function(){i.focus()})},__unlock:function(){this.modal&&(this.__popup.removeClass(this.className+"-modal"),this.__backdrop.remove(),delete this.modal)}}),e.zIndex=1024,e.current=null,e}(t),o=function(t){return{content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",padding:"",skin:"",quickClose:!1,cssUri:"./index.css",innerHTML:'<div i="dialog" class="ui-dialog"><div class="ui-dialog-arrow-a"></div><div class="ui-dialog-arrow-b"></div><table class="ui-dialog-grid"><tr><td i="header" class="ui-dialog-header"><button i="close" class="ui-dialog-close">&#215;</button><div i="title" class="ui-dialog-title"></div></td></tr><tr><td i="body" class="ui-dialog-body"><div i="content" class="ui-dialog-content"></div></td></tr><tr><td i="footer" class="ui-dialog-footer"><div i="statusbar" class="ui-dialog-statusbar"></div><div i="button" class="ui-dialog-button"></div></td></tr></table></div>'}}(t),n=function(t){var e=0,n=new Date-0,s=!("minWidth"in t("html")[0].style),r="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),a=!s&&!r,c=function(i,o,s){var h=i=i||{};"string"!=typeof i&&1!==i.nodeType||(i={content:i,fixed:!r}),i=t.extend(!0,{},c.defaults,i),i._=h;var l=i.id=i.id||n+e,d=c.get(l);return d?d.focus():(a||(i.fixed=!1),i.quickClose&&(i.modal=!0,h.backdropOpacity||(i.backdropOpacity=0)),t.isArray(i.button)||(i.button=[]),void 0!==s&&(i.cancel=s),i.cancel&&i.button.push({id:"cancel",value:i.cancelValue,callback:i.cancel,display:i.cancelDisplay}),void 0!==o&&(i.ok=o),i.ok&&i.button.push({id:"ok",value:i.okValue,callback:i.ok,autofocus:!0}),c.list[l]=new c.create(i))},h=function(){};h.prototype=i.prototype;var l=c.prototype=new h;return c.create=function(o){var n=this;t.extend(this,new i);var s=t(this.node).html(o.innerHTML);return this.options=o,this._popup=s,t.each(o,function(t,e){"function"==typeof n[t]?n[t](e):n[t]=e}),o.zIndex&&(i.zIndex=o.zIndex),s.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",this.cancel===!1?"none":"").attr("title",this.cancelValue).on("click",function(t){n._trigger("cancel"),t.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),s.on("click","[data-id]",function(e){var i=t(this);i.attr("disabled")||n._trigger(i.data("id")),e.preventDefault()}),o.quickClose&&t(this.backdrop).on("onmousedown"in document?"mousedown":"click",function(){return n._trigger("cancel"),!1}),this._esc=function(t){var e=t.target,o=e.nodeName,s=/^input|textarea$/i,r=i.current===n,a=t.keyCode;!r||s.test(o)&&"button"!==e.type||27===a&&n._trigger("cancel")},t(document).on("keydown",this._esc),this.addEventListener("remove",function(){t(document).off("keydown",this._esc),delete c.list[this.id]}),e++,c.oncreate(this),this},c.create.prototype=l,t.extend(l,{content:function(t){return this._$("content").empty("")["object"==typeof t?"append":"html"](t),this.reset()},title:function(t){return this._$("title").text(t),this._$("header")[t?"show":"hide"](),this},width:function(t){return this._$("content").css("width",t),this.reset()},height:function(t){return this._$("content").css("height",t),this.reset()},button:function(e){e=e||[];var i=this,o="",n=0;return this.callbacks={},"string"==typeof e?o=e:t.each(e,function(t,e){e.id=e.id||e.value,i.callbacks[e.id]=e.callback;var s="";e.display===!1?s=' style="display:none"':n++,o+='<button type="button" data-id="'+e.id+'"'+s+(e.disabled?" disabled":"")+(e.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+e.value+"</button>"}),this._$("footer")[n?"show":"hide"](),this._$("button").html(o),this},statusbar:function(t){return this._$("statusbar").html(t)[t?"show":"hide"](),this},_$:function(t){return this._popup.find("[i="+t+"]")},_trigger:function(t){var e=this.callbacks[t];return"function"!=typeof e||e.call(this)!==!1?this.close().remove():this}}),c.oncreate=t.noop,c.getCurrent=function(){return i.current},c.get=function(t){return void 0===t?c.list:c.list[t]},c.list={},c.defaults=o,c}(t),s=function(t){var e=t(window),i=t(document),o="createTouch"in document,n=document.documentElement,s=!("minWidth"in n.style),r=!s&&"onlosecapture"in n,a="setCapture"in n,c={start:o?"touchstart":"mousedown",over:o?"touchmove":"mousemove",end:o?"touchend":"mouseup"},h=o?function(t){return t.touches||(t=t.originalEvent.touches.item(0)),t}:function(t){return t},l=function(){this.start=t.proxy(this.start,this),this.over=t.proxy(this.over,this),this.end=t.proxy(this.end,this),this.onstart=this.onover=this.onend=t.noop};return l.types=c,l.prototype={start:function(t){return t=this.startFix(t),i.on(c.over,this.over).on(c.end,this.end),this.onstart(t),!1},over:function(t){return t=this.overFix(t),this.onover(t),!1},end:function(t){return t=this.endFix(t),i.off(c.over,this.over).off(c.end,this.end),this.onend(t),!1},startFix:function(o){return o=h(o),this.target=t(o.target),this.selectstart=function(){return!1},i.on("selectstart",this.selectstart).on("dblclick",this.end),r?this.target.on("losecapture",this.end):e.on("blur",this.end),a&&this.target[0].setCapture(),o},overFix:function(t){return t=h(t)},endFix:function(t){return t=h(t),i.off("selectstart",this.selectstart).off("dblclick",this.end),r?this.target.off("losecapture",this.end):e.off("blur",this.end),a&&this.target[0].releaseCapture(),t}},l.create=function(o,n){var s,r,a,c,h=t(o),d=new l,u=l.types.start,f=function(){},p=o.className.replace(/^\s|\s.*/g,"")+"-drag-start",_={onstart:f,onover:f,onend:f,off:function(){h.off(u,d.start)}};return d.onstart=function(t){var n="fixed"===h.css("position"),l=i.scrollLeft(),d=i.scrollTop(),u=h.width(),f=h.height();s=0,r=0,a=n?e.width()-u+s:i.width()-u,c=n?e.height()-f+r:i.height()-f;var v=h.offset(),m=this.startLeft=n?v.left-l:v.left,g=this.startTop=n?v.top-d:v.top;this.clientX=t.clientX,this.clientY=t.clientY,h.addClass(p),_.onstart.call(o,t,m,g)},d.onover=function(t){var e=t.clientX-this.clientX+this.startLeft,i=t.clientY-this.clientY+this.startTop,n=h[0].style;e=Math.max(s,Math.min(a,e)),i=Math.max(r,Math.min(c,i)),n.left=e+"px",n.top=i+"px",_.onover.call(o,t,e,i)},d.onend=function(t){var e=h.position(),i=e.left,n=e.top;h.removeClass(p),_.onend.call(o,t,i,n)},d.off=function(){h.off(u,d.start)},n?d.start(n):h.on(u,d.start),_},l}(t);n.oncreate=function(e){var i,o=e.options,n=o._,r=o.url,a=o.oniframeload;if(r&&(this.padding=o.padding=0,i=t("<iframe />"),i.attr({src:r,name:e.id,width:"100%",height:"100%",allowtransparency:"yes",frameborder:"no",scrolling:"no"}).on("load",function(){var t;try{t=i[0].contentWindow.frameElement}catch(t){}t&&(o.width||e.width(i.contents().width()),o.height||e.height(i.contents().height())),a&&a.call(e)}),e.addEventListener("beforeremove",function(){i.attr("src","about:blank").remove()},!1),e.content(i[0]),e.iframeNode=i[0]),!(n instanceof Object))for(var c=function(){e.close().remove()},h=0;h<frames.length;h++)try{if(n instanceof frames[h].Object){t(frames[h]).one("unload",c);break}}catch(t){}t(e.node).on(s.types.start,"[i=title]",function(t){e.follow||(e.focus(),s.create(e.node,t))})},n.get=function(t){if(t&&t.frameElement){var e,i=t.frameElement,o=n.list;for(var s in o)if(e=o[s],e.node.getElementsByTagName("iframe")[0]===i)return e}else if(t)return n.list[t]},window.ry_dialog=n;var r=n,a="d-loading-bar";return{dialog:r,msg:function(t,i){e(t,i,"msg-info")},success:function(t,i){e(t,i,"msg-success")},error:function(t,i){e(t,i,"msg-error")},loading:{show:function(t){var e=r({skin:"ui-loading",id:a,content:t});return e.showModal(),e},hide:function(){r.get(a).remove()}}}});