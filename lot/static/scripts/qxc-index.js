define(["jquery","app/common/lottery"],function(a,b){var c;return c=b.extend({initialize:function(b){var d=this,e=_.extend({hln:!0,lotteryId:2,cookieKey:"hkc_QuickMode"},b);c.superclass.initialize.call(this,e),this.isOpen=!0,this._np=0,this.refreshTimer=new this.CountDown(this.refreshDuration),this._config={},this.cache={lz:null,ranking:null},a(function(){d.ballTpl=a("#tpl-prev-balls").html(),d._tabs()})},close:function(){this.reset(),c.superclass.close.call(this)},open:function(a){c.superclass.open.call(this),!a&&this.refresh()},reset:function(){var a=this;c.superclass.reset.call(a),a.$ctn.find("i").removeClass("red-ball"),a.$ctn.find("select").empty(),a.$ctn.find(".j-selected-count").text(0),a._qxcInfo.sum=0,a.amount=0},afterBet:function(){this.reset(),this.refresh()},valid:function(){var a=this;return a.$ctn.find("select option").size()>0?(a._qxcInfo.amount=a.$ctn.find(".sync-bet").val(),""==a._qxcInfo.amount?(a.ui.msg(a.utils.format(a.lang.msg.emptyAmount)),!1):!0):(a.ui.msg(a.utils.format(a.lang.msg.empty)),!1)},afterRefresh:function(a){var b=this;this._updateSummary(a),this._renderBall(a),this.isOpen&&this._updateLines(a.Lines),this.refreshTimer.update=function(){},this.refreshTimer.done=function(){b.refresh()},b.refreshTimer.restart()},getRecordsHtml:function(){var d,e,b=this,c=b._qxcInfo;return d=a("#j-confirm-tpl").html(),c.total=parseInt(c.amount)*c.sum,b.betTotal=c.total,e=b._.template(d)(c)},beforeBet:function(){var c=this,d=c._qxcInfo;c.records=[{category:d.title,id:c.$ctn.data("odds")}],c.data=c.$ctn.find("select option").map(function(){return{BetContext:a(this).text().replace(/\s/g,""),Money:d.amount,Lines:d.lines,Id:c.records[0].id}}).get()},_tabs:function(){var b=this,c=a("#play-tab");b._qxcInfo={},c.on("click","li",function(c){c.preventDefault();var d=a(this),e=a(d.data("target"));b.$ctn=e,b._qxcInfo.title=d.find("a").html(),b._qxcInfo.lines=0,b._qxcInfo.sum=0,b._qxcInfo.total=0,d.addClass("active").siblings("li").removeClass("active"),b._np=d.index(),e.show().siblings().hide(),b.reset(),b.refresh(),b._qxc()}),c.find("li").eq(b._np).trigger("click")},_updateLines:function(b){var c=this,d="j"+c.$ctn.data("odds");return c._qxcInfo.lines=b[d],void a("#j-odds").html(c._qxcInfo.lines)},_renderBall:function(b){var d,c=this.ballTpl;ball=b.PreResult.split(","),d=this.tpl.to_html(c,{balls:ball}),d&&a("#prev-data").html(d)},_updateSummary:function(b){var c=this,d=b.CloseCount;d>0&&c.open(!0),null!=c.closeTimer&&c.closeTimer.stop(),c.closeTimer=new this.CountDown(d),c.closeTimer.update=function(b){a("#close-timer").text(c.tpl.to_html("{{days}}"+c.lang.date.days+"{{hours}}:{{minutes}}:{{seconds}}",c.utils.secondsFormat(b)))},c.closeTimer.done=function(){c.close(),a("#close-timer").text(c.lang.msg.closedGate)},c.closeTimer.start(),null!=c.awarTimer&&c.awarTimer.stop(),c.awarTimer=new this.CountDown(b.OpenCount),c.awarTimer.update=function(b){a("#award-timer").text(c.tpl.to_html("{{days}}"+c.lang.date.days+"{{hours}}:{{minutes}}:{{seconds}}",c.utils.secondsFormat(b)))},c.awarTimer.done=function(){b.OpenCount>0?c.open():(c.close(),a("#award-timer").text(c.lang.msg.closedGate))},c.awarTimer.start(),a("#current-issue").text(b.CurrentPeriod+c.lang.msg.issue),a("#win-lose").text(b.WinLoss),a("#prev-issue").text(b.PrePeriodNumber)},_qxc:function(){var b=this,c=b.$ctn.find("i"),d=b.$ctn.find("a"),e=b.$ctn.find("button"),f=b.$ctn.find(".j-selected-count");c.off("click").on("click",function(){a(this).toggleClass("red-ball")}),d.off("click").on("click",function(){switch(c=a(this).siblings("i"),c.removeClass("red-ball"),a(this).data("action")){case"all":c.addClass("red-ball");break;case"big":c.filter(":gt(4)").addClass("red-ball");break;case"small":c.filter(":lt(5)").addClass("red-ball");break;case"odd":c.filter(":odd").addClass("red-ball");break;case"even":c.filter(":even").addClass("red-ball")}}),e.off("click").on("click",function(){"add"==a(this).data("action")&&b._valid(),"delete"==a(this).data("action")&&b.$ctn.find("select").find(":selected").map(function(){b._qxcInfo.sum-=parseInt(a(this).val()),f.text(b._qxcInfo.sum),a(this).remove()})})},_valid:function(){var d,e,b=this,c=b.$ctn.find("select"),f=[],g=b.$ctn.find(".j-selected-count"),h=b.$ctn.find(".qxc .selected-ball").siblings(),i=h.map(function(){return e=a(this).find(".red-ball").map(function(){return a(this).text()}).get(),f.push(e),e.length>0?e.join(""):"*"}).get();return d=b._check(f),d[0]>0?(b._qxcInfo.sum+=d[0],g.text(b._qxcInfo.sum),h.find("i").removeClass("red-ball"),c.prepend(a("<option>").val(d[0]).text(i.join(", "))),!0):(b.ui.msg(d[1]),!1)},_check:function(a){var b=this,c=[];switch(b.$ctn.attr("id")){case"j-dw1":return[a.length>3?a[0].length+a[1].length+a[2].length+a[3].length:0,b.utils.format(b.lang.msg.minNumbers,1)];case"j-dw2":return a.length>=4&&(a[0].length>0&&c.push(a[0].length),a[1].length>0&&c.push(a[1].length),a[2].length>0&&c.push(a[2].length),a[3].length>0&&c.push(a[3].length),c.length>2)?[0,b.utils.format(b.lang.msg.maxGroup,2)]:[2==c.length?c[0]*c[1]:0,b.utils.format(b.lang.msg.minGroup,2)];case"j-dw3":return a.length>=4&&(a[0].length>0&&c.push(a[0].length),a[1].length>0&&c.push(a[1].length),a[2].length>0&&c.push(a[2].length),a[3].length>0&&c.push(a[3].length),c.length>3)?[0,b.utils.format(b.lang.msg.maxGroup,3)]:[3==c.length?c[0]*c[1]*c[2]:0,b.utils.format(b.lang.msg.minGroup,3)];case"j-dw4":return[a.length>3?a[0].length*a[1].length*a[2].length*a[3].length:0,b.utils.format(b.lang.msg.minGroup,4)];case"j-zx2":return a.length>=1&&a[0].length>2?[0,b.utils.format(b.lang.msg.limit,2)]:[a[0].length<2?0:1,b.utils.format(b.lang.msg.minNumbers,2)];case"j-zx3":return a.length>=1&&a[0].length>3?[0,b.utils.format(b.lang.msg.limit,3)]:[a[0].length<3?0:1,b.utils.format(b.lang.msg.minNumbers,3)]}}})});